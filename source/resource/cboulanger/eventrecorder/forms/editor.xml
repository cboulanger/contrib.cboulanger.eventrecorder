<?xml version="1.0" encoding="UTF-8"?>
<form xmlns="http://www.qookery.org/ns/Form"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/ergobyte/qookery/master/qookery/docs/form.xsd"
      layout="v-box" flex="1">

  <import service="qx.application.IApplication"/>
  <import class="qookery.contexts.Qookery"/>
  <import class="qx.data.marshal.Json"/>

  <script>
    $.Form.setModel($.Json.createModel({
      leftEditorContent: "",
      leftEditorVisible: true,
      rightEditorContent: "",
      rightEditorVisible: false,
      targetScriptType: "qooxdoo",
      targetMode: "test"
    }));
    $.scriptTypes = {
      "qooxdoo": "qooxdoo javascript (Browser)",
      "testcafe": "TestCáfé javascript (NodeJS)"
    };
    $.modes = {
      "test": "Test",
      "presentation": "Presentation"
    };
  </script>

  <!-- toolbar with collapsable part -->
  <tool-bar spacing="5">
    <!-- button to toggle visibility of left editor-->
    <button label="Hide script" id="toggleLeftEditorButton">
      <script>$.Form.getModel().bind("rightEditorVisible", this, "enabled");</script>
      <script event="execute">
        $.Form.executeAction("toggleLeftEditor");
      </script>
    </button>
    <!-- spacer to keep following widgets to the right -->
    <spacer flex="1" />
    <!-- hidden when rightEditorVisible is false -->
    <composite id="export-menu" layout="h-box" spacing="5">
      <script>
        $.Form.getModel().bind("rightEditorVisible", this, "visibility", { converter: v => v ? "visible" : "excluded"});
      </script>
      <button label="Translate">
        <script event="execute">
          $.Form.executeAction("translate");
        </script>
      </button>
      <button label="Export">
        <script event="execute">
          $.Form.executeAction("export");
        </script>
      </button>
      <select-box connect="targetScriptType" width="200">
        <script>this.setItems($.scriptTypes);</script>
      </select-box>
      <select-box connect="targetMode" width="150">
        <script>this.setItems($.modes);</script>
      </select-box>
    </composite>
    <!-- toggle visibility of right editor-->
    <button label="Show translation" id="toggleRightEditorButton">
      <script>$.Form.getModel().bind("leftEditorVisible", this, "enabled");</script>
      <script event="execute">
        $.Form.executeAction("toggleRightEditor");
      </script>
    </button>
  </tool-bar>

  <!-- actions -->
  <script action="translate">
    $.Form.getQxOwner().translateTo($.Form.getModel().getTargetScriptType(), $.Form.getModel().getTargetMode());
  </script>
  <script action="export">
    $.Form.getQxOwner().exportTo($.Form.getModel().getTargetScriptType(), $.Form.getModel().getTargetMode());
  </script>
  <script action="toggleLeftEditor"><![CDATA[
        let leftEditorVisible = $.Form.getModel().getLeftEditorVisible();
        $.Form.getModel().setLeftEditorVisible(!leftEditorVisible);
        $("#toggleLeftEditorButton").setLabel(leftEditorVisible? "Hide script" : "Show script");
      ]]>
  </script>
  <script action="toggleRightEditor"><![CDATA[
        let rightEditorVisible = $.Form.getModel().getRightEditorVisible();
        $.Form.getModel().setRightEditorVisible(!rightEditorVisible);
        $("#toggleRightEditorButton").setLabel(rightEditorVisible? "Show translation" : "Hide translation");
        $.Form.executeAction("translate");
      ]]>
  </script>

  <!-- editors -->
  <composite layout="h-box" flex="1">
    <ace:editor xmlns:ace="http://www.qookery.org/ns/Form/Ace"
                xsi:schemaLocation="https://raw.githubusercontent.com/cboulanger/qookery/master/qookeryace/docs/form-ace.xsd"
                id="leftEditor" mode="text"
                connect="leftEditorContent"
                flex="1" create-label="false" tab-size="2" theme="eclipse">
      <script>
        $.Form.getModel().bind("leftEditorVisible", this, "visibility", { converter: v => v ? "visible" : "excluded"});
      </script>
    </ace:editor>
    <ace:editor xmlns:ace="http://www.qookery.org/ns/Form/Ace"
                xsi:schemaLocation="https://raw.githubusercontent.com/cboulanger/qookery/master/qookeryace/docs/form-ace.xsd"
                id="rightEditor" mode="javascript"
                connect="rightEditorContent"
                flex="1" create-label="false" tab-size="2" theme="eclipse">
      <script>
        $.Form.getModel().bind("rightEditorVisible", this, "visibility", { converter: v => v ? "visible" : "excluded"});
      </script>
    </ace:editor>
  </composite>

</form>
